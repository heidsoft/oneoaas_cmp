function open_vm_side(){var e=$("#vm_side");e.removeClass("hidden"),getComputedStyle(document.querySelector("body")).display,e.find("#close").addClass("open"),e.find(".shield-edit").addClass("open"),e.find("#shield-detail").removeClass("hidden"),$("article.shield-content").css("overflow","hidden")}function close_vm_side(){var e=$("#vm_side");e.find(".shield-edit").removeClass("open").children("#shield-detail").addClass("hidden"),e.find("#close").removeClass("open"),setTimeout(function(){e.addClass("hidden"),$("article.shield-content").css("overflow","auto")},300)}var VCenterManage=function(e,t){var a;return{vmTable:null,selectedRows:[],init:function(t){var a={search:"搜索：",lengthMenu:"每页显示 _MENU_ 记录",zeroRecords:"没找到相应的数据！",info:"分页 _PAGE_ / _PAGES_",infoEmpty:"暂无数据！",infoFiltered:"(从 _MAX_ 条数据中搜索)",paginate:{first:"<<",last:">>",previous:"上一页",next:"下一页"}},s=e(t).DataTable({paging:!0,ordering:!1,info:!1,searching:!1,pageLength:5,lengthChange:!1,language:a,sLoadingRecords:!0,ajax:{url:site_url+"vmware/api/getVcenterVirtualMachineList"},columnDefs:[{targets:0,className:"dt-head-center dt-body-center",checkboxes:{selectRow:!0}}],select:{style:"multi"},columns:[{data:"id"},{title:"名称",data:"name"},{title:"内存(MB)",data:"memorySizeMB"},{title:"CPU个数",data:"numCpu"},{title:"最大CPU使用",data:"maxCpuUsage"},{title:"最大内存使用",data:"maxMemoryUsage"},{title:"是否为模板",data:"template",render:function(e,t,a){return!1===e?"不是模板":"是模板"}},{title:"系统类型",data:"guest_fullname"},{title:"运行状态",data:"power_state",render:function(e,t,a){return"poweredOn"===e?"运行":"poweredOff"===e?"关机":void 0}},{title:"总体状态",data:"overallStatus",render:function(e,t,a){return"green"===e?"正常":e}},{title:"IP",data:"ipaddress"}]});return this.vmTable=s,new e.fn.dataTable.Buttons(s,{buttons:[{extend:"copyHtml5",text:"拷贝表格"},{extend:"excelHtml5",text:"导出Excel"},{extend:"pdfHtml5",text:"导出PDF"},{extend:"csvHtml5",bom:"utf-8",text:"导出CSV"}]}),s.buttons().container().appendTo(s.table().container()),s},beforeAction:function(){var s=this.vmTable.column(0).checkboxes.selected();if(void 0===s||0===s.length)return t.warning("请选择虚拟机资源"),setTimeout(function(){a.remove()},300),!1;var n=this.selectedRows=[];return e.each(s,function(e,t){n.push(t)}),this.selectedRows=n,!0},create:function(){t.warning("这是高级功能，蓝鲸社区版暂不支持该功能,如果需要请联系OneOaaS")},clone:function(){if(VCenterManage.progressbarModal(),this.beforeAction()){if(this.selectedRows.length>1)return t.warning("蓝鲸版克隆操作只支持选择一台虚拟机"),void a.remove();e("#cloneVmWizard").modal("show"),a.remove()}},executeClone:function(){var a=e("#cloneVmName").val(),s=e("#select_datacenter .select2_box").select2("val"),n=e("#select_cluster .select2_box").select2("val"),o=e("#select_datastore .select2_box").select2("val");e.ajax({url:site_url+"vmware/api/clone",type:"post",dataType:"json",data:{vmId:this.selectedRows[0],vmName:a,vmDatacenter:s,vmCluster:n,vmDatastore:o},success:function(a){e("#cloneVmWizard").modal("hide"),t.success(a.message),VCenterManage.vmTable.ajax.reload(null,!1)}})},poweroff:function(s){if(VCenterManage.progressbarModal(),this.beforeAction())return this.selectedRows.length>1?(t.warning("蓝鲸版关机操作只支持一台虚拟机"),void a.remove()):void e.ajax({url:site_url+"vmware/api/poweroff",type:"post",dataType:"json",data:{vmId:this.selectedRows[0]},success:function(e){a.remove(),t.success(e.message),VCenterManage.vmTable.ajax.reload(null,!1)}})},start:function(s){if(VCenterManage.progressbarModal(),this.beforeAction())return this.selectedRows.length>1?(t.warning("蓝鲸版开机操作只支持一台虚拟机"),void a.remove()):void e.ajax({url:site_url+"vmware/api/start",type:"post",dataType:"json",data:{vmId:this.selectedRows[0]},success:function(e){a.remove(),t.success(e.message),VCenterManage.vmTable.ajax.reload(null,!1)},error:function(){a.remove()}})},reboot:function(s){if(VCenterManage.progressbarModal(),this.beforeAction())return this.selectedRows.length>1?(t.warning("蓝鲸版重启操作只支持一台虚拟机"),void a.remove()):void e.ajax({url:site_url+"vmware/api/reboot",type:"post",dataType:"json",data:{vmId:this.selectedRows[0]},success:function(e){a.remove(),t.success(e.message),VCenterManage.vmTable.ajax.reload(null,!1)},error:function(){a.remove()}})},destroy:function(s){if(VCenterManage.progressbarModal(),this.beforeAction()){if(this.selectedRows.length>1)return t.warning("蓝鲸版销毁操作只支持一台虚拟机"),void a.remove();dialog({width:260,title:"提示",content:"确认销毁？",okValue:"确定",ok:function(){e.ajax({url:site_url+"vmware/api/destroy",type:"post",dataType:"json",data:{vmId:VCenterManage.selectedRows[0]},success:function(e){a.remove(),t.success(e.message),VCenterManage.vmTable.ajax.reload(null,!1)},error:function(){a.remove()}})},cancelValue:"取消",cancel:function(){a.remove()},onshow:function(){}}).show()}},snapshot:function(){this.beforeAction()&&(this.selectedRows.length>1?t.warning("蓝鲸版克隆操作只支持选择一台虚拟机"):e("#snapshotVmWizard").modal("show"))},executeSnapshot:function(){var a=e("#snapshotName").val(),s=e("#snapshotDesc").val();e.ajax({url:site_url+"vmware/api/createVMSnapshot",type:"post",dataType:"json",data:{vmId:this.selectedRows[0],name:a,description:s},success:function(a){e("#snapshotVmWizard").modal("hide"),a.result?t.success(a.message):t.error(a.message)}})},lookup:function(e){console.log("查看详情1"+e)},async:function(a){this.beforeAction()&&e.ajax({url:site_url+"vmware/api/asyncDemo",type:"post",dataType:"json",data:{id:this.selectedRows[0]},success:function(e){t.success(e.message),VCenterManage.vmTable.ajax.reload(null,!1)}})},webssh:function(){VCenterManage.progressbarModal(),window.location.href=site_url+"vmware/webssh/manage"},RDP:function(){t.warning("这是高级功能，蓝鲸社区版暂不支持该功能,如果需要请联系OneOaaS")},progressbarModal:function(){a=dialog({cancel:!1,padding:0,width:500,content:'<div id="progressbar"></div>'}),e("#progressbar").progressbar({value:!1}),a.showModal()}}}($,window.toastr);$(document).ready(function(){$("#ccAppList .select2_box").select2({ajax:{url:site_url+"vmware/api/getAppList",cache:!1,results:function(e){return e}}}),$("#select_datacenter .select2_box").select2({ajax:{url:site_url+"vmware/api/getAllDatacenter",cache:!1,results:function(e){return e}}}),$("#select_cluster .select2_box").select2({ajax:{url:site_url+"vmware/api/getAllCluster",cache:!1,results:function(e){return e}}}),$("#select_datastore .select2_box").select2({ajax:{url:site_url+"vmware/api/getAllDatastore",cache:!1,results:function(e){return console.log(e),e}}}),$("#createVmWizard").bootstrapWizard({tabClass:"nav nav-pills",onNext:function(e,t,a){console.log("onNext:"+a),console.log(t),console.log(e)},onPrevious:function(e,t,a){console.log("onPrevious"+a),console.log("onPrevious"+a)}}),$("#rootwizard .finish").click(function(){alert("Finished!, Starting over!")}),VCenterManage.init("#vcenter_manage_record"),$("#vm_side").find("#cancel").click(function(){close_vm_side()}),$("#close, #sideContent").on("click",function(e){"close"==$(e.target).attr("data-type")&&close_vm_side()})});